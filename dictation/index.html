<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±Ë™û„ÅÆ„Éá„Ç£„ÇØ„ÉÜ„Éº„Ç∑„Éß„É≥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f1ed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
            min-height: 700px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        select {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            font-size: 1rem;
            border: 2px solid #d4c4b0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        select:focus {
            outline: none;
            border-color: #a0826d;
        }

        .edit-button, .reset-history-button {
            padding: 12px 20px;
            font-size: 0.95rem;
            border: 2px solid #d4c4b0;
            background: white;
            color: #8b7355;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            white-space: nowrap;
        }

        .edit-button:hover, .reset-history-button:hover {
            background: #8b7355;
            color: white;
            transform: translateY(-2px);
        }

        button {
            padding: 15px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: 600;
        }

        .play-button {
            width: 100%;
            background: #8b7355;
            color: white;
            margin-bottom: 20px;
        }

        .play-button:hover:not(:disabled) {
            background: #6f5c45;
            transform: translateY(-2px);
        }

        .play-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .input-section {
            margin-bottom: 20px;
        }

        .input-section label {
            display: block;
            margin-bottom: 10px;
            color: #555;
            font-weight: 600;
        }

        .input-section input {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid #d4c4b0;
            border-radius: 10px;
            transition: border-color 0.3s;
        }

        .input-section input:focus {
            outline: none;
            border-color: #a0826d;
        }

        .button-group {
            margin-bottom: 20px;
            min-height: 50px;
        }

        .next-button {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.3s, visibility 0.3s;
            font-weight: 600;
            background: #8b7355;
            color: white;
        }

        .next-button:hover:not(:disabled) {
            background: #6f5c45;
            transform: translateY(-2px);
        }

        .next-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .next-button.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .interval-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            min-height: 48px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .interval-buttons.show {
            opacity: 1;
            visibility: visible;
        }

        .interval-button {
            flex: 1;
            min-width: 80px;
            padding: 12px 10px;
            font-size: 0.95rem;
            border: 2px solid #ddd;
            background: white;
            color: #333;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .interval-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .interval-button.again {
            border-color: #c17b6f;
            color: #a35e53;
        }

        .interval-button.again:hover {
            background: #c17b6f;
            color: white;
        }

        .interval-button.day {
            border-color: #c9a66b;
            color: #a68a56;
        }

        .interval-button.day:hover {
            background: #c9a66b;
            color: white;
        }

        .interval-button.week {
            border-color: #9fb89f;
            color: #7a967a;
        }

        .interval-button.week:hover {
            background: #9fb89f;
            color: white;
        }

        .interval-button.month {
            border-color: #8ba888;
            color: #5d7a5c;
        }

        .interval-button.month:hover {
            background: #8ba888;
            color: white;
        }

        .interval-button.never {
            border-color: #999;
            color: #666;
        }

        .interval-button.never:hover {
            background: #999;
            color: white;
        }

        .review-info {
            text-align: center;
            margin-bottom: 15px;
            color: #8b7355;
            font-weight: 600;
        }

        .result {
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
            min-height: 250px;
            max-height: 250px;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .result.show {
            opacity: 1;
            visibility: visible;
        }

        .result.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .result.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .answer-display {
            margin-top: 10px;
            font-size: 1rem;
            color: #555;
            cursor: pointer;
            padding: 8px;
            border-radius: 5px;
            transition: background 0.2s;
        }

        .answer-display:hover {
            background: rgba(139, 115, 85, 0.1);
        }

        .answer-display.copied {
            background: rgba(139, 195, 74, 0.2);
        }

        .diff {
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .diff-char {
            padding: 2px 4px;
            border-radius: 3px;
            margin: 0 1px;
        }

        .diff-correct {
            background: #c3e6cb;
            color: #155724;
        }

        .diff-wrong {
            color: #dc3545;
            font-weight: bold;
        }

        .diff-missing {
            background: #fff3cd;
            color: #856404;
            font-weight: bold;
        }

        .hint {
            text-align: center;
            color: #999;
            font-size: 0.9rem;
            margin-top: 20px;
            line-height: 1.6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 2px solid #d4c4b0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: #8b7355;
            margin: 0;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 2rem;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .close-button:hover {
            color: #333;
        }

        .modal-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .modal-info {
            background: #f9f5f0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            color: #8b7355;
            border-left: 4px solid #a0826d;
        }

        textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            font-size: 1rem;
            border: 2px solid #d4c4b0;
            border-radius: 10px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #a0826d;
        }

        .modal-footer {
            padding: 20px;
            border-top: 2px solid #d4c4b0;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-footer button {
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .save-button {
            background: #8b7355;
            color: white;
            border: none;
        }

        .save-button:hover {
            background: #6f5c45;
            transform: translateY(-2px);
        }

        .reset-button {
            background: #c17b6f;
            color: white;
            border: none;
        }

        .reset-button:hover {
            background: #a35e53;
            transform: translateY(-2px);
        }

        .cancel-button {
            background: white;
            color: #8b7355;
            border: 2px solid #d4c4b0;
        }

        .cancel-button:hover {
            background: #f5f1ed;
            transform: translateY(-2px);
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #8b7355;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            font-weight: 600;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            z-index: 2000;
            pointer-events: none;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <select id="presetSelect">
                <option value="basic">ÂàùÁ¥ö</option>
                <option value="intermediate">‰∏≠Á¥ö</option>
                <option value="travel">ÊóÖË°åËã±‰ºöË©±</option>
                <option value="eiken2">Ëã±Ê§ú2Á¥ö</option>
                <option value="eiken1">Ëã±Ê§ú1Á¥ö</option>
                <option value="anime_violet">„Ç¢„Éã„É°Ëã±‰ºöË©±„Äå„É¥„Ç°„Ç§„Ç™„É¨„ÉÉ„Éà„Éª„Ç®„É¥„Ç°„Éº„Ç¨„Éº„Éá„É≥„Äç</option>
                <option value="anime_frieren">„Ç¢„Éã„É°Ëã±‰ºöË©±„ÄåËë¨ÈÄÅ„ÅÆ„Éï„É™„Éº„É¨„É≥„Äç</option>
                <option value="anime_dungeon">„Ç¢„Éã„É°Ëã±‰ºöË©±„Äå„ÉÄ„É≥„Ç∏„Éß„É≥È£Ø„Äç</option>
                <option value="custom1">„Ç´„Çπ„Çø„É† 1</option>
                <option value="custom2">„Ç´„Çπ„Çø„É† 2</option>
                <option value="custom3">„Ç´„Çπ„Çø„É† 3</option>
            </select>
            <button class="edit-button" id="editButton">Á∑®ÈõÜ</button>
            <button class="reset-history-button" id="resetHistoryButton">Â≠¶ÁøíÂ±•Ê≠¥„É™„Çª„ÉÉ„Éà</button>
        </div>

        <div class="controls">
            <select id="voiceSelect">
                <option value="">Èü≥Â£∞„ÇíÈÅ∏Êäû...</option>
            </select>
        </div>

        <button class="play-button" id="playButton">üîä Èü≥Â£∞„ÇíÂÜçÁîü</button>

        <div class="input-section">
            <label for="userInput">ËÅû„ÅçÂèñ„Å£„ÅüÊñáÁ´†„ÇíÂÖ•Âäõ„Åó„Å¶„É™„Çø„Éº„É≥</label>
            <input type="text" id="userInput" placeholder="‰æã: I live in Tokyo." autocomplete="off" lang="en" inputmode="latin">
        </div>

        <div class="result" id="result"></div>

        <div class="interval-buttons" id="intervalButtons">
            <button class="interval-button again" data-interval="again">1Ô∏è‚É£ Again</button>
            <button class="interval-button day" data-interval="day">2Ô∏è‚É£ 1 Day</button>
            <button class="interval-button week" data-interval="week">3Ô∏è‚É£ 1 Week</button>
            <button class="interval-button month" data-interval="month">4Ô∏è‚É£ 1 Month</button>
            <button class="interval-button never" data-interval="never">5Ô∏è‚É£ Never</button>
        </div>

        <div class="review-info" id="reviewInfo"></div>

        <div class="button-group">
            <button class="next-button" id="nextButton" disabled>Ê¨°„ÅÆÂïèÈ°å ‚Üí</button>
        </div>

        <div class="hint">
            üí° „Éí„É≥„Éà: Ctrl + R „ÅßÈü≥Â£∞„ÇíÂÜçÁîü | Ctrl + S „Åß„Çπ„É≠„ÉºÂÜçÁîü<br>
            Enter „ÅßÂõûÁ≠îÈÄÅ‰ø°„ÉªAgainÈÅ∏Êäû | 1-5„Ç≠„Éº„ÅßÈñìÈöîÈÅ∏Êäû | Á≠î„Åà„Çí„ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç≥„Éî„Éº
        </div>
    </div>

    <!-- Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÂïèÈ°å„Çª„ÉÉ„Éà„ÇíÁ∑®ÈõÜ</h2>
                <button class="close-button" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-info">
                    üìù 1Ë°å„Å´1„Å§„ÅÆÂïèÈ°å„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÁ∑®ÈõÜÂÜÖÂÆπ„ÅØ„Éñ„É©„Ç¶„Ç∂„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åô„ÄÇ
                </div>
                <textarea id="questionsTextarea" placeholder="‰æã:&#10;This is a pen.&#10;I love learning English.&#10;The cat is sleeping."></textarea>
            </div>
            <div class="modal-footer">
                <button class="save-button" id="saveButton">üíæ ‰øùÂ≠ò</button>
                <button class="reset-button" id="resetButton">üîÑ ÂàùÊúüÂÄ§„Å´Êàª„Åô</button>
                <button class="cancel-button" id="cancelButton">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>
    </div>

    <!-- „Éà„Éº„Çπ„ÉàÈÄöÁü• -->
    <div class="toast" id="toast"></div>

    <script>
        // „Éá„Éï„Ç©„É´„Éà„ÅÆÂïèÈ°å„Éá„Éº„Çø„ÅÆ„Éó„É™„Çª„ÉÉ„Éà
        const defaultQuestionPresets = {
            basic: [
                "I live in Tokyo.", "She likes coffee.", "He is a student.", "We are friends.", "This is my book.",
                "That is your pen.", "They have a car.", "I want to eat pizza.", "She can speak English.", "He will go tomorrow.",
                "I am happy today.", "The weather is nice.", "I study every day.", "She works at a bank.", "He plays the guitar.",
                "We eat breakfast together.", "They are watching TV.", "I need some water.", "This is very good.", "I like reading books.",
                "She is cooking dinner.", "He goes to school.", "We love music.", "They are my family.", "I have a question.",
                "The cat is sleeping.", "I walk to work.", "She speaks three languages.", "He likes sports.", "We are learning English.",
                "I need your help.", "This room is clean.", "She has two dogs.", "He drives a bus.", "We visit the museum.",
                "They play soccer.", "I drink tea.", "The store is open.", "She writes letters.", "He makes breakfast.",
                "We listen to music.", "They run every morning.", "I see a bird.", "The door is closed.", "She teaches math.",
                "He sells flowers.", "We need more time.", "They are kind people.", "I feel tired.", "The movie was great.",
                "I take a shower.", "She reads the newspaper.", "He has a meeting.", "We are waiting here.", "They know the answer.",
                "I bought a new phone.", "This is delicious food.", "She wears a red dress.", "He is thirty years old.", "We can help you.",
                "I understand the problem.", "The train is late.", "She loves chocolate.", "He sings very well.", "We are going home.",
                "They live in London.", "I want some ice cream.", "This book is interesting.", "She studies hard.", "He works night shifts.",
                "We enjoy traveling.", "They speak quietly.", "I forgot my keys.", "The park is beautiful.", "She dances gracefully.",
                "He is a doctor.", "We are busy today.", "They arrived early.", "I cooked Italian food.", "This chair is comfortable.",
                "She swims every week.", "He is watching a game.", "We have three children.", "They are eating lunch.", "I like your shirt.",
                "The sky is blue.", "She is very smart.", "He plays tennis.", "We need a taxi.", "They are my neighbors."
            ].concat(Array(418).fill(0).map((_, i) => [
                "Good morning everyone.", "Have a nice day.", "See you later.", "Thank you very much.", "You are welcome.",
                "I am sorry.", "Excuse me please.", "How are you doing.", "Nice to meet you.", "What is your name.",
                "Where are you from.", "I am from Japan.", "How old are you.", "I am twenty years old.", "What do you do.",
                "I am a teacher.", "Do you like coffee.", "Yes I do.", "No I do not.", "What time is it.",
                "It is three o clock.", "Where is the bathroom.", "It is over there.", "Can I help you.", "No thank you.",
                "How much is this.", "It is ten dollars.", "I will take it.", "Here you are.", "Have a good one.",
                "Take care now.", "See you soon.", "Catch you later.", "How was your day.", "It was great thanks.",
                "What are you doing.", "I am working now.", "Are you busy.", "Yes I am.", "No I am not.",
                "Where do you work.", "I work at a bank.", "What time do you start.", "I start at nine.", "When do you finish.",
                "I finish at five.", "Do you have time.", "Yes I have time.", "Can we meet tomorrow.", "Sure no problem."
            ][i % 50])),
            intermediate: [
                "I have been studying English for three years.", "She told me that she would come to the party.", 
                "If it rains tomorrow, we will cancel the trip.", "I wish I could speak Japanese fluently.", 
                "The book that I bought yesterday was very interesting.", "He has been working here since last year.",
                "I would appreciate it if you could help me.", "She suggested that we should leave early.",
                "I have never been to Europe before.", "They were surprised to hear the news.",
                "I am looking forward to seeing you again.", "She made me feel welcome.",
                "I could not believe what I was hearing.", "He decided to quit his job.",
                "I am thinking about moving to another city.", "She is good at playing the piano.",
                "I spent the whole day cleaning the house.", "They managed to solve the problem.",
                "I would rather stay home than go out.", "She asked me to call her later.",
                "I am used to getting up early.", "He seems to be enjoying himself.",
                "I need to get my car fixed.", "She let me borrow her umbrella.",
                "I am sorry for being late.", "They invited us to join them.",
                "I hope everything goes well.", "She reminded me about the meeting.",
                "I cannot afford to buy a new computer.", "He offered to drive me home.",
                "I am planning to visit my parents next month.", "She succeeded in passing the exam.",
                "I had my hair cut yesterday.", "They prevented us from entering the building.",
                "I am afraid of flying in airplanes.", "She is interested in learning French.",
                "I will let you know as soon as possible.", "He advised me to see a doctor.",
                "I am supposed to be there by noon.", "She convinced me to change my mind.",
                "I regret not studying harder in school.", "They expected us to arrive on time.",
                "I cannot stand waiting in long lines.", "She encouraged me to follow my dreams.",
                "I am considering taking a vacation.", "He promised to return my book.",
                "I happened to meet an old friend.", "She refused to answer my question.",
                "I tend to forget people's names.", "They agreed to help us move."
            ].concat(Array(250).fill(0).map((_, i) => [
                "The conference has been postponed until next month.", "I have been meaning to call you about that.",
                "She has a talent for making people laugh.", "I would have come if I had known.",
                "The restaurant we went to was highly recommended.", "I am not sure whether I should accept the offer.",
                "He has been acting strangely lately.", "I find it difficult to concentrate sometimes.",
                "She gave me some advice on how to improve.", "I wish I had paid more attention in class.",
                "The project turned out better than expected.", "I am having trouble understanding this concept.",
                "She is capable of achieving great things.", "I ought to have mentioned it earlier.",
                "The weather has been quite unpredictable recently.", "I am determined to finish this by Friday.",
                "She insisted on paying for dinner.", "I wonder if they will arrive on time.",
                "The movie was not as good as I expected.", "I would like to propose a toast.",
                "She deserves to be recognized for her work.", "I am aware of the risks involved.",
                "The situation is more complicated than it seems.", "I cannot help feeling a bit worried.",
                "She has a tendency to overreact sometimes.", "I am glad we had this conversation.",
                "The new policy will come into effect next month.", "I failed to notice the warning sign.",
                "She is responsible for managing the team.", "I should have listened to your advice.",
                "The exhibition was worth visiting.", "I am curious about what happens next.",
                "She managed to convince everyone.", "I do not mind waiting a little longer.",
                "The instructions were somewhat confusing.", "I am impressed by your dedication.",
                "She appears to be in a good mood.", "I cannot imagine living without technology.",
                "The deadline has been extended by one week.", "I am confident that we will succeed.",
                "She tends to arrive early for meetings.", "I was amazed by the performance.",
                "The report needs to be submitted tomorrow.", "I am grateful for your support.",
                "She seems to understand the situation.", "I cannot remember where I put my wallet.",
                "The experience taught me a valuable lesson.", "I am excited about the new opportunity.",
                "She decided against going to the party.", "I would prefer to discuss this in private."
            ][i % 50])),
            travel: [
                "Where is the nearest station?", "How much does this cost?", "Can you help me?",
                "I would like to make a reservation.", "What time does the train leave?",
                "Excuse me, where is the bathroom?", "How do I get to the airport?",
                "I need a taxi please.", "Can I have the menu?", "I would like a table for two.",
                "Do you accept credit cards?", "Where can I buy tickets?", "Is there free WiFi here?",
                "What time do you close?", "Can I try this on?", "How long does it take?",
                "I am looking for a hotel.", "Is breakfast included?", "Can I check in now?",
                "Where is my room?", "I lost my key.", "Can I have a wake up call?",
                "Is there a map available?", "Where can I exchange money?", "Do you have a tour guide?",
                "I need to call a doctor.", "Where is the nearest hospital?", "I lost my passport.",
                "Can you call the police?", "I need an interpreter.", "Where is the embassy?",
                "Can I have a receipt?", "Is there a discount?", "Can I pay by card?",
                "I would like to cancel my reservation.", "Can I change my booking?", "Where is the bus stop?",
                "Which platform does it leave from?", "Is this seat taken?", "Can I put my bag here?",
                "Where is the luggage claim?", "I cannot find my suitcase.", "My flight is delayed.",
                "Where can I check in?", "Do I need to transfer?", "Is this the right train?",
                "How many stops until we get there?", "Can you tell me when we arrive?", "I need to get off here."
            ].concat(Array(250).fill(0).map((_, i) => [
                "I have a reservation under this name.", "Could you recommend a good restaurant?",
                "Is there a pharmacy nearby?", "I need to see a dentist.", "Where can I rent a car?",
                "How much is a taxi to the city center?", "Do you have any rooms available?",
                "I would like a non smoking room.", "Can I have an extra pillow?", "The air conditioning is not working.",
                "Could you send someone to fix it?", "What time is checkout?", "Can I extend my stay?",
                "Is there a safe in the room?", "Where can I do my laundry?", "Do you have a gym?",
                "Is there a swimming pool?", "Can I order room service?", "What is the WiFi password?",
                "My room has not been cleaned.", "I need more towels please.", "The shower is broken.",
                "Can I speak to the manager?", "I would like to file a complaint.", "The bill seems incorrect.",
                "Can you call a cab for me?", "What time does the tour start?", "How long is the tour?",
                "Are meals included in the price?", "Where should we meet?", "Can I take photos here?",
                "Is there an entrance fee?", "Do you offer group discounts?", "Where can I buy souvenirs?",
                "Can you wrap this as a gift?", "Do you ship internationally?", "I would like to return this.",
                "This does not fit me.", "Do you have this in another color?", "Can I get a refund?",
                "Where is the fitting room?", "This is exactly what I wanted.", "I am just looking around.",
                "Can you show me something else?", "Is this on sale?", "When does the sale end?",
                "Do you have a loyalty program?", "Can I use this coupon?", "Where do I pay for this?",
                "Can you hold this for me?", "I will think about it."
            ][i % 50])),
            eiken2: Array(200).fill(0).map((_, i) => [
                "Environmental protection is everyone's responsibility.",
                "Technology has changed the way we communicate.",
                "Education plays a crucial role in society.",
                "Global warming is a serious environmental issue.",
                "Renewable energy sources are becoming more popular.",
                "Social media has transformed modern communication.",
                "Healthcare systems need continuous improvement.",
                "Cultural diversity enriches our communities.",
                "Economic development should be sustainable.",
                "Scientific research leads to important discoveries.",
                "International cooperation is essential for peace.",
                "Recycling helps reduce waste and pollution.",
                "Public transportation reduces traffic congestion.",
                "Healthy eating habits prevent many diseases.",
                "Regular exercise improves physical and mental health.",
                "Volunteer work benefits both individuals and society.",
                "Lifelong learning keeps our minds active.",
                "Work life balance is important for wellbeing.",
                "Digital literacy is essential in modern times.",
                "Climate change affects weather patterns globally.",
                "Biodiversity is vital for ecosystem stability.",
                "Urban planning should prioritize green spaces.",
                "Tourism contributes significantly to local economies.",
                "Artificial intelligence is advancing rapidly.",
                "Cybersecurity is increasingly important today.",
                "Remote work has become more common recently.",
                "Financial literacy helps people make better decisions.",
                "Mental health awareness is growing worldwide.",
                "Pollution has serious health consequences.",
                "Conservation efforts protect endangered species.",
                "Innovation drives economic growth forward.",
                "Democracy requires active citizen participation.",
                "Human rights must be protected everywhere.",
                "Gender equality remains an important goal.",
                "Poverty reduction requires comprehensive strategies.",
                "Immigration policies affect many countries.",
                "Aging populations present new challenges.",
                "Youth unemployment is a global concern.",
                "Infrastructure development supports economic growth.",
                "Natural disasters cause widespread destruction.",
                "Disaster preparedness saves lives and property.",
                "Food security is a fundamental human need.",
                "Water scarcity affects millions of people.",
                "Deforestation contributes to climate change.",
                "Sustainable agriculture protects our environment.",
                "Globalization has both benefits and drawbacks.",
                "International trade connects economies worldwide.",
                "Cultural exchange promotes mutual understanding.",
                "Language learning opens new opportunities.",
                "Arts and culture enrich human experience."
    ][i % 50]),
            eiken1: Array(200).fill(0).map((_, i) => [
                "The implementation of sustainable practices requires comprehensive planning.",
                "Contemporary literature reflects the complexities of modern society.",
                "Economic inequality remains a persistent challenge globally.",
                "Diplomatic negotiations often involve delicate compromises.",
                "Technological innovation has revolutionized countless industries.",
                "Historical perspectives provide valuable insights into current events.",
                "Philosophical debates continue to shape human thought.",
                "Geopolitical tensions influence international relations significantly.",
                "Sociological studies reveal underlying cultural patterns.",
                "Psychological research enhances our understanding of behavior.",
                "Anthropological findings illuminate diverse human societies.",
                "Linguistic analysis uncovers the evolution of languages.",
                "Archaeological discoveries reshape our understanding of history.",
                "Astronomical observations expand our cosmic perspective.",
                "Biological diversity demonstrates nature's remarkable adaptability.",
                "Chemical processes govern fundamental life functions.",
                "Physical phenomena follow universal mathematical principles.",
                "Mathematical models predict complex system behaviors.",
                "Statistical analysis provides evidence based conclusions.",
                "Epidemiological studies track disease patterns globally.",
                "Neurological research advances our brain knowledge.",
                "Genetic engineering raises important ethical questions.",
                "Quantum mechanics challenges classical physics assumptions.",
                "Relativity theory transformed our space time understanding.",
                "Evolutionary biology explains species adaptation mechanisms.",
                "Ecological systems demonstrate intricate interdependencies.",
                "Climate science reveals long term environmental trends.",
                "Oceanographic research explores underwater ecosystems thoroughly.",
                "Meteorological predictions rely on sophisticated computer models.",
                "Geological formations record Earth's ancient history.",
                "Seismological data helps predict earthquake probabilities.",
                "Volcanic activity shapes landscapes over millennia.",
                "Hydrological cycles maintain freshwater availability globally.",
                "Atmospheric composition directly affects climate patterns.",
                "Biodegradation processes naturally decompose organic materials.",
                "Photosynthesis converts sunlight into chemical energy.",
                "Cellular respiration powers all living organisms.",
                "DNA replication ensures genetic information transmission.",
                "Protein synthesis creates essential biological molecules.",
                "Immune responses protect against pathogenic invasions.",
                "Hormonal regulation coordinates complex bodily functions.",
                "Neuronal connections form intricate brain networks.",
                "Cognitive processes enable higher order thinking.",
                "Perception involves interpreting sensory information meaningfully.",
                "Memory consolidation occurs during sleep cycles.",
                "Learning mechanisms adapt through repeated exposure.",
                "Motivation drives goal directed behavior patterns.",
                "Emotional intelligence influences interpersonal relationships significantly.",
                "Social cognition affects our interaction quality.",
                "Cultural norms shape individual behavioral expectations."
    ][i % 50]),
            anime_violet: [
                "Major Gilbert, I've been in the hospital for 120 days now.",
                "Don't worry, Violet. He's the one who asked me to come here for you.",
                "Because the Major's brother once told me,",
                "These arms are made of adamant silver.",
                "Oh, I forgot to tell you.",
                "Oh, why'd you do that? You didn't listen to me. This is Benedict, he's a postman here.",
                "You just got out of the hospital after all.",
                "Someday, you'll understand what I said.",
                "The Major said those words to me, after he gave me my last orders.",
                "She's going to work as an apprentice auto memories doll starting today.",
                "Iris, can we borrow your manual?",
                "The two reservations we have for this afternoon both asked for Catalea.",
                "I'm not getting any salary this month.",
                "Do you think you will be able to survive until then, sir?",
                "Type the company in the address and the type of industry.",
                "Ma'am, please! Calm down, it's all right.",
                "They constantly test others in order to confirm their own existence.",
                "But if we get a bad reputation because of this,",
                "My feelings, which were buried away.",
                "I just want to graduate and then go home.",
                "I've been trained to keep my eating to a minimum during an important mission.",
                "In today's class, we will be training to write on another's behalf.",
                "Regarding the places we have been and desire to go,",
                "Violet, I hope that one day you'll be able to see that beautiful view in Leiden.",
                "I knew you would come here.",
                "To be honest, sometimes I don't even know what I'm supposed to say to him.",
                "Where were you out so late?",
                "Without the need for flowery embellishment.",
                "Aw man, I am so unlucky!",
                "Both now, and when I first met her,",
                "I'm the one who requested you.",
                "That's why you brought me back here?!",
                "Apparently Montgomery just passed his teacher's certification test.",
                "You're still going on about that?",
                "I was in love with him.",
                "Are you interested in telling them exactly how you are feeling?",
                "Violet was the one who typed it.",
                "Do you mean with the North? Precisely.",
                "You will be writing the public love letter for me.",
                "She is wondering if that would be an issue for you.",
                "And then I think to myself,",
                "Princess Charlotte, how would you like me to prepare the next letter?",
                "When I saw you at the banquet,",
                "It's just that we're so different in age.",
                "I do remember you laughed at my tear-stained face.",
                "Not the man in the letter,",
                "Will you do me the honor of marrying me",
                "It's a beautiful day for a wedding",
                "the Shahar Astronomy Headquarters has a library specializing",
                "It is a pleasure to meet you.",
                "The arrow of light appeared in the past as well,",
                "Our duty as dolls is to travel anywhere for our clients,",
                "So if for some reason your upbringing limits the circle of people",
                "Don't you want to see it?",
                "His work involved visiting dangerous territories as well.",
                "What if someone told you that person was in danger during your contract with me?",
                "Sir, it was a short time, but thank you for taking care of me.",
                "May you burn with the rest of the criminals.",
                "If I am not to your satisfaction, I can arrange for another doll to take my place.",
                "What's the matter? Is there a problem with it?",
                "What are you thinking? Is it good?",
                "Is there something you're hiding inside your heart?",
                "Parting with someone who is important to you,",
                "Will you, please, try opening the parasol for me?",
                "Thank you for using our automated memories doll service.",
                "After the final battle in Intense,",
                "As I thought. Once a weapon, always a weapon.",
                "Young Master, I managed to get her changed, but she would not stop struggling.",
                "I'd like you to lead a company to take out those cannons.",
                "is there anything that you want?",
                "Do you think we'll be able to go home by spring?",
                "You know, you should use her skills in a more appropriate way.",
                "While the enemy's distracted, we'll use the sewers to infiltrate Intance,",
                "Once the war ends, please take her to the Evergarden house in Leiden.",
                "One of our new delivery men threw away the letters he couldn't get around to delivering.",
                "You and I, we are too.",
                "I'm afraid he sprained his ankle.",
                "But I just landed a new job, and I owe it to her.",
                "I see what you're saying, but‚Ä¶ It's important to do.",
                "It will eventually be expelled from my body and returned to the earth.",
                "Oh, but I thought you were too big to take naps anymore.",
                "Excuse me. Your room is ready, ma'am.",
                "That is what Miss Cattleya said.",
                "But I know my mom doesn't like bugs.",
                "My mom got sick because I'm a bad girl!",
                "your mother loves you very much, even now.",
                "Can I assign this job to you, Catalea?",
                "Like I said, it's outside our delivery area, so...",
                "Yeah, but going over that mountain is ‚Ä¶",
                "That's because the moderates are a bunch of cowards.",
                "I want to write that letter.",
                "But I shipped out before we could ever do anything about it.",
                "It is believed that they are looking to converge with other units.",
                "Considering what you've just been through.",
                "And as for Violet, she won't be coming. Well, I think that's for the best",
                "This railroad also allows food and resources to enter my country.",
                "Cattleya, can you tell me where you are headed?",
                "A peace envoy is aboard a special train that left from Disturi,",
                "There are some in the back, and I heard noises from the front.",
"You and I, we both have the memories of violence burned into us like scars."
            ],
            anime_frieren: [
                "Long range magic is created by combining three key factors that are essential to all mages.",
                "There was nothing about spells for resurrecting the dead or immortality.",
                "In the end, he settled with a ridiculously standard pose.",
                "It really is just a hobby.",
                "That way is the direction of our inn.",
                "Excuse me, can I ask you about something?",
                "I bet it consumes a great deal of mana as well.",
                "Sure they did. Just one time.",
                "But with the current level of magic, we can't really observe souls after they die,",
                "Plus, don't you want to get to know more about Himmel?",
                "It's just that, she's a very strange person.",
                "people have witnessed ghosts of their dead friends and family in the mountains,",
                "Now let's go to see the real Highter.",
                "Stark, why haven't you taken down the dragon?",
                "If you're curious, go and see. I'm going to sleep now.",
                "I just thought it was a strange question.",
                "Do you have any idea when the checkpoint will open up again?",
                "You do have a bad guy's face.",
                "Well, I'm glad I got to see this view though.",
                "Elves like me live for a very long time,",
                "But can it be communicated with?",
                "It's a beautiful word that... ...works just like magic.",
                "All we have to do next is win over Graf Granat, and this town will easily fall.",
                "Lord Lugnar, I will ask you one last time.",
                "Like the strong defense barrier, which keeps demons out and protects this town,",
                "As soon as I stop bleeding, we'll go after them.",
                "The bigger the risk, the stronger the spell.",
                "I'd meant to hit your vitals, but then you went and moved.",
                "She's overpowering you with her sheer number of moves.",
                "She will kill Aura by deceiving her.",
                "Your injuries are looking much better.",
                "that status and wealth mean to humans.",
                "a mysterious elven mage whose exact age is unknown.",
                "Is that why you became a hero then?",
                "why didn't you hire other adventurers to help you in your situation?",
                "I guess I have no choice but to ask him myself.",
                "No wonder my family never celebrated my birthday.",
                "It's really not the time to be caring about that.",
                "You must be a healing expert.",
                "I haven't fought an actual demon in more than 500 years.",
                "So Master Hider was an upstanding priest after all.",
                "Never did I regret the decision I made back then, not even once!",
                "Anyway, you didn't have to get so mad because he forgot to get a present.",
                "Children need an adult in their lives who can be there to give them emotional support.",
                "You're a warrior. A fall from this hide wouldn't kill you.",
                "Even then, I'm sure it's very precious.",
                "Mages cannot detect curses as well as priests can.",
                "We are forever indebted to you.",
                "You may take whichever one you like from the library.",
                "Then all the more reason I can't stay here.",
                "It doesn't really matter, not anymore.",
                "Well, yes, that is important too, but...",
                "she would have opened up to us within half a day.",
                "I was able to rent a cabin for us.",
                "If you want to make peace with her, you have to let her know that yourself.",
                "I may not be gifted like a priest,",
                "It doesn't feel so bad, right?",
                "control, hard work, and tenacity are also factored in.",
                "I'm surprised there's anyone around who still knows what this is.",
                "I guess that means I'm Party No. 2?",
                "I'm so sorry. The thing is, we've always been like this with each other.",
                "All 57 participants will now be split in parties of three to take this exam.",
                "it's difficult for you two to stall the shtilla with your magic, right?",
                "What in the world does she think she's doing?",
                "I can win against you even with both my eyes closed.",
                "This is most likely a spell that cuts through objects.",
                "The type of magic one specializes in is strongly",
                "Let's go! We'll meet up with Sharf.",
                "Fighting over the bird is just a pretense for a battle real.",
                "She will bestow upon them one spell of their choice.",
                "This really is nothing but babysitting.",
                "Either way, they're just wasting their time.",
                "I can't believe you actually managed to destroy the barrier.",
                "Because it wouldn't sit right with me.",
                "There are a ton of restaurants around here. Just choose one.",
                "I, Lekker, the greatest chef of the century,",
                "Alright, let's go buy something together.",
                "I'm sure that's all it really takes.",
                "It's still a prototype, but it's safe enough to use.",
                "And before I know it, I'll have saved the world.",
                "Why do those things make her so happy?",
                "We believe that Spiegel reads the memories of those who entered the dungeon,",
                "Of course, not that it really matters at all.",
                "An expert in hypnosis magic may be able to find its weakness.",
                "I thought a complete barrier of defensive magic would last a maximum of 15 seconds.",
                "to raid the ruins of the King's tomb, and my oldest brother was part of it.",
                "In any case, let's discuss her strategy.",
                "How greedy can that woman get?",
                "Do not neglect your training, Freiren.",
                "This is the spell that I specialize in.",
                "Any fabric can be cut. You see it all the time.",
                "I can concentrate on mana detection better when I'm alone.",
                "I told Mistress Freiren that I wanted to get it repaired,",
                "just when I was starting to feel a bit better.",
                "I didn't. I don't know what he's talking about.",
                "It's hard to believe that a mage like you was able to defeat someone like the Demon King.",
                "Did you change your mind about me?",
"Fearne, for me, magic was only ever a tool to resolve political disputes.",
                "But I'm sure you already know that.",
                "One more thing before I go."
            ],
            anime_dungeon: [
                "It all began in a tiny village.",
                "And the herbivore monsters eat plants, which need water light and dirt to grow.",
                "You won't die, but it tastes like ass.",
                "This algae is soft and delicious too.",
                "See that flower its formal name is baris alia and it grows along trails animals use",
                "Well, it is a carnivorous plant.",
                "The Basilisk has another head on its tail, so it seems like it has no blind spots.",
                "So here's how we do it.",
                "parts are the body uh-uh the chicken parts the tail",
                "it's open great so how are we gonna get the oil out of it i have no idea this looks like",
                "Why'd you have to be so rough with it?",
                "Stealth skills don't work on things that aren't alive.",
                "But together, they use the armor like a structure.",
                "I thought it was a dungeon prank, but maybe that was a mating ritual!",
                "These jars are filled with a different kind of fertilizer.",
                "Hey, Senshi, hang on. Why do you go to all this trouble to live down here?",
                "Don't tell me your usual customers.",
                "All orcs ever did was rob and kill and terrorize everyone.",
                "Delicious dungeon food brings folks together.",
                "But I'll cast a spell so they don't turn into zombies.",
                "If someone were to eat one of these, what would happen to them?",
                "To some folks, they were symbols of the sun and the sun god.",
                "Still, you're right, we need food or we won't have the energy to fight.",
                "I'll have to eat what I can while I'm still inside it!",
                "There should be a lever around here...",
                "At first was panicking because I thought it would eat the treasure insect.",
                "You see, that didn't kill you, did it?",
                "Why is a cow okay, but a fish man somehow isn't?",
                "but I have handled Squid and Octopi.",
                "But if we don't do it, the village will get completely overrun by them.",
                "I took some dirt and water from here and added it to my jar.",
                "Are you serious? Does it really have to be now?",
                "Don't push yourself. If you kick the bucket, Fallon would be sad.",
                "I'm already losing feeling in my arm.",
                "We can't wait that long. I agree",
                "Can it hold up against an Undine?",
                "Look at all these different tentacles.",
                "I would suggest sending in troops or offering a bounty.",
                "Those are the eyes of someone looking for something.",
                "If you fall from this height,",
                "Everyone, I want to say something.",
                "It's not looking too good. All the plans we had set up failed.",
                "Even I was shaking in my boots.",
                "Then we're looking at about 840 bones total.",
                "Cause everything turned out well in the end!",
                "Now, skin it and place it in a soup.",
                "We still gotta use our sleeping bags, you know.",
                "Senshi, I need you to wake up Laios for me.",
                "If it's coming from you, I can't argue.",
                "Damn it, what are YOU doing here?",
                "Like that guy said before he left,",
                "It's too bad monsters aren't like that.",
                "Hey, Holm, or Ren, look closer at this ghost-repelling spell.",
                "He's delusional in his old age,",
                "we've clearly got a long ways to go.",
                "My eyes are suddenly getting itchy.",
                "You really need to step up.",
                "Forgive me for being so ignorant!",
                "Oh crap she got hardened in a really dangerous pose.",
                "When one place gets blocked, another opens up.",
                "I'm glad the blood trail wasn't there anymore.",
                "Did we come here for nothing?",
                "Senshi! I'll come out for the fire!",
                "His appetite was lacking and it made everyone around him worry.",
                "Is this all my fault? Should I have followed Laios instead of Senshi?",
                "You will not lay a finger on them.",
                "That sincere look in your eyes",
                "Will he seal away this dungeon without a word?",
                "Hang on, but didn't I hear that he...",
                "Let's avoid fighting unknown monsters under these circumstances.",
                "Our Chilchuck is definitely much cuter!",
                "Since it targets people, it's either a carnivore or an omnivore.",
                "I thought you knew black magic.",
                "As you can see, The tool's ability isn't used to its fullest,",
                "if we manage to free Fallon,",
                "This place is dangerous, you need to leave.",
                "I go a lot faster than everyone else.",
                "I think we were around there last time.",
                "lightly boil the shapeshifter meat and remove any scum that forms.",
                "You can't be a picky eater when you're inside a dungeon,",
                "None of those things are bad on their own.",
                "I'd like you to join me as a witness.",
                "and their origins in the strange company",
                "There's nothing else that behaves in as many different ways as an egg does.",
                "We milk this instead of cows.",
                "Do you know why the mage would do something like that?",
                "Well, make sure you take the night to think about it.",
                "Just rest here for a bit.",
                "So, who exactly is that old dwarf guy anyway?",
                "Stronger! I'll put more horns here, arrange the fangs,",
                "The fear finally snapped them out of their trance,",
                "If we cut it up and make soup out of it,",
                "so Senshi's party could have been wrong too.",
                "The way it grabbed Senshi, but didn't eat him.",
                "Maybe we see if we can find the winged lion.",
"Put the filling on the flattened dough, and then...",
"then this mushroom is too good to be true.",
"An animal steps into a changeling ring and transforms.",
"I guess I'll brew some tea.",
"Meat digested by another creature loses its identity."
            ],
            custom1: [],
            custom2: [],
            custom3: []
        };

        // ÂïèÈ°å„Éá„Éº„ÇøÔºà„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâË™≠„ÅøËæº„Åø„ÄÅ„Å™„Åë„Çå„Å∞„Éá„Éï„Ç©„É´„Éà„Çí‰ΩøÁî®Ôºâ
        let questionPresets = JSON.parse(localStorage.getItem('customQuestionPresets')) || JSON.parse(JSON.stringify(defaultQuestionPresets));

        // Âæ©Áøí„Çπ„Ç±„Ç∏„É•„Éº„É´
        let reviewSchedule = JSON.parse(localStorage.getItem('reviewSchedule')) || {};

        // Áä∂ÊÖãÁÆ°ÁêÜ
        let currentPreset = 'basic';
        let allQuestions = [];
        let questions = [];
        let currentQuestionIndex = 0;
        let correctCount = 0;
        let attemptedCount = 0;
        let hasChecked = false;
        let isFinished = false;

        // Âæ©Áøí„Çπ„Ç±„Ç∏„É•„Éº„É´„Çí‰øùÂ≠ò
        function saveReviewSchedule() {
            localStorage.setItem('reviewSchedule', JSON.stringify(reviewSchedule));
        }

        // Âæ©Áøí„Çπ„Ç±„Ç∏„É•„Éº„É´„ÇíË™≠„ÅøËæº„Åø
        function loadReviewSchedule() {
            const saved = localStorage.getItem('reviewSchedule');
            if (saved) {
                reviewSchedule = JSON.parse(saved);
            }
        }

        // Ê¨°Âõû„ÅÆÂæ©ÁøíÊó•ÊôÇ„ÇíË®àÁÆó
        function calculateNextReview(interval) {
            const now = new Date();
            switch (interval) {
                case 'again':
                    return now.getTime();
                case 'day':
                    return now.getTime() + (24 * 60 * 60 * 1000);
                case 'week':
                    return now.getTime() + (7 * 24 * 60 * 60 * 1000);
                case 'month':
                    return now.getTime() + (30 * 24 * 60 * 60 * 1000);
                case 'never':
                    return 'never';
                default:
                    return now.getTime();
            }
        }

        // ÈÖçÂàó„Çí„Ç∑„É£„ÉÉ„Éï„É´„Åô„ÇãÈñ¢Êï∞
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Âæ©Áøí„ÅåÂøÖË¶Å„Å™ÂïèÈ°å„ÇíÂèñÂæó
        function getDueQuestions(preset) {
            const allQuestions = questionPresets[preset];
            const now = new Date().getTime();
            
            if (!reviewSchedule[preset]) {
                reviewSchedule[preset] = {};
            }

            const dueQuestions = allQuestions.filter(question => {
                const nextReview = reviewSchedule[preset][question];
                if (nextReview === 'never') {
                    return false;
                }
                return !nextReview || nextReview <= now;
            });

            return dueQuestions;
        }

        // ÂïèÈ°å„Çí„É≠„Éº„Éâ
        function loadQuestions(preset) {
            allQuestions = questionPresets[preset];
            const dueQuestions = getDueQuestions(preset);
            questions = shuffleArray(dueQuestions);
            updateReviewInfo();
        }

        // Âæ©ÁøíÊÉÖÂ†±„ÇíÊõ¥Êñ∞
        function updateReviewInfo() {
            const reviewInfo = document.getElementById('reviewInfo');
            reviewInfo.textContent = '';
        }

        const playButton = document.getElementById('playButton');
        const nextButton = document.getElementById('nextButton');
        const userInput = document.getElementById('userInput');
        const result = document.getElementById('result');
        const presetSelect = document.getElementById('presetSelect');
        const editButton = document.getElementById('editButton');
        const editModal = document.getElementById('editModal');
        const closeModal = document.getElementById('closeModal');
        const questionsTextarea = document.getElementById('questionsTextarea');
        const saveButton = document.getElementById('saveButton');
        const resetButton = document.getElementById('resetButton');
        const cancelButton = document.getElementById('cancelButton');
        const intervalButtons = document.getElementById('intervalButtons');
        const resetHistoryButton = document.getElementById('resetHistoryButton');
        const voiceSelect = document.getElementById('voiceSelect');
        const toast = document.getElementById('toast');

        let availableVoices = [];
        let selectedVoice = null;

        // „Éà„Éº„Çπ„ÉàË°®Á§∫Èñ¢Êï∞
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // ÂàùÊúü„É≠„Éº„Éâ
        loadReviewSchedule();
        loadQuestions(currentPreset);
        
        if (questions.length === 0) {
            playButton.disabled = true;
            userInput.disabled = true;
        }
        if (allQuestions.length === 0) {
            resetHistoryButton.disabled = true;
        }

        // Â≠¶ÁøíÂ±•Ê≠¥„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥
        resetHistoryButton.addEventListener('click', () => {
            const confirmed = confirm(`„Äå${presetSelect.options[presetSelect.selectedIndex].text}„Äç„ÅÆÂ≠¶ÁøíÂ±•Ê≠¥„Çí„Åô„Åπ„Å¶„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü\n\n„Åô„Åπ„Å¶„ÅÆÂïèÈ°å„ÅåÂ≠¶ÁøíÂæÖ„Å°„Å´„Å™„Çä„ÄÅÊúÄÂàù„Åã„ÇâÂ≠¶Áøí„ÅóÁõ¥„Åô„Åì„Å®„Å´„Å™„Çä„Åæ„Åô„ÄÇ`);
            if (!confirmed) return;

            if (reviewSchedule[currentPreset]) {
                reviewSchedule[currentPreset] = {};
                saveReviewSchedule();
            }

            loadQuestions(currentPreset);
            resetQuiz();

            alert('Â≠¶ÁøíÂ±•Ê≠¥„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü„ÄÇ');
        });

        // „Éó„É™„Çª„ÉÉ„ÉàÂ§âÊõ¥ÊôÇ„ÅÆÂá¶ÁêÜ
        presetSelect.addEventListener('change', () => {
            const newPreset = presetSelect.value;
            
            currentPreset = newPreset;
            loadQuestions(currentPreset);
            resetQuiz();
            
            if (allQuestions.length === 0) {
                resetHistoryButton.disabled = true;
            } else {
                resetHistoryButton.disabled = false;
            }
        });

        // Èü≥Â£∞Ë™≠„Åø‰∏ä„Åí
        function speakText(text, rate = 0.8) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                    utterance.lang = selectedVoice.lang;
                } else {
                    utterance.lang = 'en-US';
                }
                
                utterance.rate = rate;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;

                playButton.disabled = true;
                const speedText = rate < 0.8 ? ' („Çπ„É≠„Éº)' : '';
                playButton.textContent = `üîä ÂÜçÁîü‰∏≠...${speedText}`;

                utterance.onend = () => {
                    playButton.disabled = false;
                    playButton.textContent = 'üîä Èü≥Â£∞„ÇíÂÜçÁîü';
                };

                utterance.onerror = () => {
                    playButton.disabled = false;
                    playButton.textContent = 'üîä Èü≥Â£∞„ÇíÂÜçÁîü';
                };

                window.speechSynthesis.speak(utterance);
            }
        }

        // Èü≥Â£∞ÈÅ∏Êäû
        function loadVoices() {
            availableVoices = window.speechSynthesis.getVoices();
            
            const englishVoices = availableVoices.filter(voice => 
                voice.lang.startsWith('en') && 
                !voice.name.includes('Albert') &&
                !voice.name.includes('Junior')
            );

            const maleVoices = englishVoices.filter(v => 
                v.name.includes('Male') || 
                v.name.includes('David') || 
                v.name.includes('James') ||
                v.name.includes('Aaron') ||
                v.name.includes('Fred')
            ).slice(0, 5);

            const femaleVoices = englishVoices.filter(v => 
                v.name.includes('Female') || 
                v.name.includes('Samantha') || 
                v.name.includes('Karen') ||
                v.name.includes('Victoria') ||
                v.name.includes('Moira')
            ).slice(0, 5);

            voiceSelect.innerHTML = '<option value="">Èü≥Â£∞„ÇíÈÅ∏Êäû...</option>';

            if (maleVoices.length > 0) {
                const maleGroup = document.createElement('optgroup');
                maleGroup.label = 'Áî∑ÊÄß';
                maleVoices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = voice.name;
                    option.dataset.voiceName = voice.name;
                    maleGroup.appendChild(option);
                });
                voiceSelect.appendChild(maleGroup);
            }

            if (femaleVoices.length > 0) {
                const femaleGroup = document.createElement('optgroup');
                femaleGroup.label = 'Â•≥ÊÄß';
                femaleVoices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = index + maleVoices.length;
                    option.textContent = voice.name;
                    option.dataset.voiceName = voice.name;
                    femaleGroup.appendChild(option);
                });
                voiceSelect.appendChild(femaleGroup);
            }

            availableVoices = [...maleVoices, ...femaleVoices];
            
            // Samantha„Çí„Éá„Éï„Ç©„É´„Éà„Å®„Åó„Å¶ÈÅ∏Êäû
            const samanthaIndex = availableVoices.findIndex(v => v.name.includes('Samantha'));
            if (samanthaIndex !== -1) {
                voiceSelect.value = samanthaIndex;
                selectedVoice = availableVoices[samanthaIndex];
            }
        }

        if (window.speechSynthesis.onvoiceschanged !== undefined) {
            window.speechSynthesis.onvoiceschanged = loadVoices;
        }
        loadVoices();

        voiceSelect.addEventListener('change', () => {
            const selectedIndex = voiceSelect.value;
            if (selectedIndex !== '') {
                selectedVoice = availableVoices[selectedIndex];
            } else {
                selectedVoice = null;
            }
        });

        // Èü≥Â£∞ÂÜçÁîü„Éú„Çø„É≥
        playButton.addEventListener('click', () => {
            if (questions.length === 0) {
                alert('ÂïèÈ°å„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÂïèÈ°å„Çª„ÉÉ„Éà„ÇíÁ∑®ÈõÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            speakText(questions[currentQuestionIndex]);
        });

        // ÈñìÈöîÈÅ∏Êäû„Éú„Çø„É≥
        document.querySelectorAll('.interval-button').forEach(button => {
            button.addEventListener('click', () => {
                const interval = button.dataset.interval;
                const currentQuestion = questions[currentQuestionIndex];
                
                const nextReview = calculateNextReview(interval);
                if (!reviewSchedule[currentPreset]) {
                    reviewSchedule[currentPreset] = {};
                }
                reviewSchedule[currentPreset][currentQuestion] = nextReview;
                saveReviewSchedule();
                
                intervalButtons.classList.remove('show');
                nextButton.classList.remove('hidden');
                nextButton.disabled = false;
                
                setTimeout(() => {
                    nextButton.click();
                }, 300);
            });
        });

        // Âè•Ë™≠ÁÇπ„Å®Â§ßÊñáÂ≠ó„ÇíÁÑ°Ë¶ñ„Åó„Å¶Ê≠£Ë¶èÂåñ„Åô„ÇãÈñ¢Êï∞
        function normalizeText(text) {
            return text
                .toLowerCase()
                .replace(/[.,!?;:'"]/g, '')  // Âè•Ë™≠ÁÇπ„ÇíÂâäÈô§
                .replace(/\s+/g, ' ')         // ÈÄ£Á∂ö„Åô„ÇãÁ©∫ÁôΩ„Çí1„Å§„Å´
                .trim();
        }

        // Á≠î„ÅàÂêà„Çè„ÅõÂá¶ÁêÜ
        function checkAnswer() {
            if (hasChecked) return;

            if (questions.length === 0) {
                alert('ÂïèÈ°å„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÂïèÈ°å„Çª„ÉÉ„Éà„ÇíÁ∑®ÈõÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            const userAnswer = userInput.value.trim();
            if (!userAnswer) {
                alert('ÂõûÁ≠î„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            const correctAnswer = questions[currentQuestionIndex];
            const isCorrect = normalizeText(userAnswer) === normalizeText(correctAnswer);

            hasChecked = true;
            attemptedCount++;
            userInput.disabled = true;

            if (isCorrect) {
                correctCount++;
                result.className = 'result correct show';
                result.innerHTML = 'üéâ Ê≠£Ëß£„Åß„ÅôÔºÅ<div class="answer-display" data-answer="' + correctAnswer + '" title="„ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç≥„Éî„Éº">Á≠î„Åà: ' + correctAnswer + '</div>';
            } else {
                result.className = 'result incorrect show';
                result.innerHTML = '‚ùå ÊÆãÂøµ„ÄÅ‰∏çÊ≠£Ëß£„Åß„Åô<div class="answer-display" data-answer="' + correctAnswer + '" title="„ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç≥„Éî„Éº">Ê≠£Ëß£: ' + correctAnswer + '<br>„ÅÇ„Å™„Åü„ÅÆÂõûÁ≠î: ' + userAnswer + '</div>';
            }
            
            // Á≠î„ÅàË°®Á§∫ÈÉ®ÂàÜ„Å´„ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇíËøΩÂä†
            const answerDisplay = result.querySelector('.answer-display');
            if (answerDisplay) {
                answerDisplay.addEventListener('dblclick', function() {
                    const answer = this.dataset.answer;
                    navigator.clipboard.writeText(answer).then(() => {
                        showToast('üìã „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
                        this.classList.add('copied');
                        const originalTitle = this.title;
                        this.title = '„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ';
                        
                        setTimeout(() => {
                            this.classList.remove('copied');
                            this.title = originalTitle;
                        }, 1000);
                    }).catch(err => {
                        console.error('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', err);
                        showToast('‚ùå „Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    });
                });
            }

            intervalButtons.classList.add('show');
            nextButton.classList.add('hidden');
        }

        // Â∑ÆÂàÜË°®Á§∫„ÇíÁîüÊàê
        function generateDiff(correct, user) {
            const correctNorm = normalizeText(correct);
            const userNorm = normalizeText(user);
            
            let diffHtml = '<div class="diff">';
            const maxLen = Math.max(correctNorm.length, userNorm.length);
            
            for (let i = 0; i < maxLen; i++) {
                const correctChar = correctNorm[i] || '';
                const userChar = userNorm[i] || '';
                
                if (correctChar === userChar) {
                    // ‰∏ÄËá¥„Åó„ÅüÊñáÂ≠ó„ÅØÈÄöÂ∏∏Ë°®Á§∫
                    diffHtml += `<span class="diff-char">${correctChar}</span>`;
                } else {
                    // ‰∏ÄËá¥„Åó„Å™„Åã„Å£„ÅüÊñáÂ≠ó„ÅØËµ§Ëâ≤
                    diffHtml += `<span class="diff-char diff-wrong">${correctChar || ''}</span>`;
                }
            }
            
            diffHtml += '</div>';
            return diffHtml;
        }

        // Ê¨°„ÅÆÂïèÈ°å„Å∏
        nextButton.addEventListener('click', () => {
            if (isFinished) {
                resetQuiz(true);
                return;
            }

            currentQuestionIndex++;
            
            if (currentQuestionIndex >= questions.length) {
                isFinished = true;
                nextButton.textContent = 'ÊúÄÂàù„Åã„Çâ';
                userInput.disabled = true;
                playButton.disabled = true;
                result.className = 'result show';
                result.style.background = '#f9f5f0';
                result.style.color = '#8b7355';
                result.style.border = '2px solid #d4c4b0';
                result.innerHTML = '„Åô„Åπ„Å¶„ÅÆÊñá„ÇíÂ≠¶Áøí„Åó„Åæ„Åó„Åü„ÄÇ';
                
                playButton.disabled = true;
                intervalButtons.classList.remove('show');
                nextButton.classList.remove('hidden');
                nextButton.disabled = false;
                return;
            }

            hasChecked = false;
            userInput.value = '';
            userInput.disabled = false;
            userInput.focus();
            result.className = 'result';
            nextButton.disabled = true;
            playButton.disabled = false;
            intervalButtons.classList.remove('show');
            nextButton.classList.remove('hidden');

            speakText(questions[currentQuestionIndex]);
        });

        // „ÇØ„Ç§„Ç∫„Çí„É™„Çª„ÉÉ„Éà
        function resetQuiz(autoSpeak = false) {
            loadQuestions(currentPreset);
            currentQuestionIndex = 0;
            correctCount = 0;
            attemptedCount = 0;
            hasChecked = false;
            isFinished = false;
            userInput.value = '';
            userInput.disabled = false;
            result.className = 'result';
            nextButton.textContent = 'Ê¨°„ÅÆÂïèÈ°å ‚Üí';
            nextButton.disabled = true;
            intervalButtons.classList.remove('show');
            nextButton.classList.remove('hidden');
            
            if (questions.length === 0) {
                playButton.disabled = true;
                userInput.disabled = true;
                result.className = 'result show';
                result.style.background = '#f9f5f0';
                result.style.color = '#8b7355';
                result.style.border = '2px solid #d4c4b0';
                result.innerHTML = '„Åô„Åπ„Å¶„ÅÆÊñá„ÇíÂ≠¶Áøí„Åó„Åæ„Åó„Åü„ÄÇ';
                nextButton.textContent = 'ÊúÄÂàù„Åã„Çâ';
                nextButton.disabled = false;
                nextButton.classList.remove('hidden');
            } else {
                playButton.disabled = false;
                if (autoSpeak) {
                    speakText(questions[currentQuestionIndex]);
                }
            }
        }

        // „Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà
        document.addEventListener('keydown', (e) => {
            if (editModal.classList.contains('show')) {
                return;
            }

            // Ctrl + R „ÅßÈü≥Â£∞ÂÜçÁîü
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                if (!playButton.disabled && questions.length > 0) {
                    speakText(questions[currentQuestionIndex], 0.8);
                }
                return;
            }
            
            // Ctrl + S „Åß„Çπ„É≠„ÉºÂÜçÁîü
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                if (!playButton.disabled && questions.length > 0) {
                    speakText(questions[currentQuestionIndex], 0.5);
                }
                return;
            }
            
            // ÈñìÈöîÈÅ∏Êäû„Éú„Çø„É≥„ÅÆ„Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà
            if (intervalButtons.classList.contains('show')) {
                const keyMap = {
                    '1': 'again',
                    '2': 'day',
                    '3': 'week',
                    '4': 'month',
                    '5': 'never'
                };
                
                if (keyMap[e.key]) {
                    const button = document.querySelector(`.interval-button[data-interval="${keyMap[e.key]}"]`);
                    if (button) {
                        button.click();
                    }
                    return;
                }
                
                // Enter„Ç≠„Éº„Åß„ÄåAgain„Äç„ÇíÈÅ∏Êäû
                if (e.key === 'Enter') {
                    const againButton = document.querySelector('.interval-button[data-interval="again"]');
                    if (againButton) {
                        againButton.click();
                    }
                    return;
                }
            }
            
            // Enter„Ç≠„Éº„ÅßÁ≠î„ÅàÂêà„Çè„Åõ or Ê¨°„ÅÆÂïèÈ°å„Å∏
            if (e.key === 'Enter') {
                if (!hasChecked && !isFinished) {
                    checkAnswer();
                } else if (!nextButton.disabled && !nextButton.classList.contains('hidden')) {
                    nextButton.click();
                }
            }
        });

        // „É¢„Éº„ÉÄ„É´Âà∂Âæ°
        editButton.addEventListener('click', () => {
            const currentQuestions = questionPresets[currentPreset];
            questionsTextarea.value = currentQuestions.join('\n');
            
            if (currentQuestions.length === 0) {
                questionsTextarea.placeholder = "„Åì„Åì„Å´ÂïèÈ°å„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n‰æã:\nThis is a pen.\nI love learning English.\nThe cat is sleeping.";
            }
            
            editModal.classList.add('show');
            questionsTextarea.focus();
        });

        closeModal.addEventListener('click', () => {
            editModal.classList.remove('show');
        });

        cancelButton.addEventListener('click', () => {
            editModal.classList.remove('show');
        });

        saveButton.addEventListener('click', () => {
            const text = questionsTextarea.value.trim();
            const newQuestions = text ? text.split('\n').filter(q => q.trim() !== '') : [];
            
            questionPresets[currentPreset] = newQuestions;
            localStorage.setItem('customQuestionPresets', JSON.stringify(questionPresets));
            
            loadQuestions(currentPreset);
            resetQuiz();
            
            if (allQuestions.length === 0) {
                resetHistoryButton.disabled = true;
            } else {
                resetHistoryButton.disabled = false;
            }
            
            editModal.classList.remove('show');
            alert('‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
        });

        resetButton.addEventListener('click', () => {
            const confirmed = confirm('„Åì„ÅÆ„Éó„É™„Çª„ÉÉ„Éà„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åó„Åæ„Åô„ÅãÔºü');
            if (confirmed) {
                questionPresets[currentPreset] = JSON.parse(JSON.stringify(defaultQuestionPresets[currentPreset]));
                localStorage.setItem('customQuestionPresets', JSON.stringify(questionPresets));
                questionsTextarea.value = questionPresets[currentPreset].join('\n');
                alert('ÂàùÊúüÂÄ§„Å´Êàª„Åó„Åæ„Åó„Åü„ÄÇ');
            }
        });

        editModal.addEventListener('click', (e) => {
            if (e.target === editModal) {
                editModal.classList.remove('show');
            }
        });
    </script>
</body>
</html>
